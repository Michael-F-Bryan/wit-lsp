<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Provides a dynamic value type abstraction."><title>minijinja::value - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-5bc39a1768837dd0.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="minijinja" data-themes="" data-resource-suffix="" data-rustdoc-version="1.77.2 (25ef9e3d8 2024-04-09)" data-channel="1.77.2" data-search-js="search-dd67cee4cfa65049.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-4c98445ec4002617.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-48f368f3872407c8.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-04d5337699b92874.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button><a class="logo-container" href="../../minijinja/index.html"><img src="https://github.com/mitsuhiko/minijinja/raw/main/artwork/logo-square.png" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../../minijinja/index.html"><img src="https://github.com/mitsuhiko/minijinja/raw/main/artwork/logo-square.png" alt="logo"></a><h2><a href="../../minijinja/index.html">minijinja</a><span class="version">2.0.1</span></h2></div><h2 class="location"><a href="#">Module value</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In crate minijinja</a></h2></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../minijinja/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">minijinja</a>::<wbr><a class="mod" href="#">value</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/minijinja/value/mod.rs.html#1-1589">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Provides a dynamic value type abstraction.</p>
<p>This module gives access to a dynamically typed value which is used by
the template engine during execution.</p>
<p>For the most part the existence of the value type can be ignored as
MiniJinja will perform the necessary conversions for you.  For instance
if you write a filter that converts a string you can directly declare the
filter to take a <a href="https://doc.rust-lang.org/1.77.2/alloc/string/struct.String.html" title="struct alloc::string::String"><code>String</code></a>.  However for some more
advanced use cases it’s useful to know that this type exists.</p>
<h2 id="basic-value-conversions"><a class="doc-anchor" href="#basic-value-conversions">§</a>Basic Value Conversions</h2>
<p>Values are typically created via the <a href="https://doc.rust-lang.org/1.77.2/core/convert/trait.From.html" title="trait core::convert::From"><code>From</code></a> trait:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>std::collections::BTreeMap;
<span class="kw">let </span>int_value = Value::from(<span class="number">42</span>);
<span class="kw">let </span>none_value = Value::from(());
<span class="kw">let </span>true_value = Value::from(<span class="bool-val">true</span>);
<span class="kw">let </span>map = Value::from({
    <span class="kw">let </span><span class="kw-2">mut </span>m = BTreeMap::new();
    m.insert(<span class="string">"foo"</span>, <span class="number">1</span>);
    m.insert(<span class="string">"bar"</span>, <span class="number">2</span>);
    m
});</code></pre></div>
<p>Or via the <a href="https://doc.rust-lang.org/1.77.2/core/iter/traits/collect/trait.FromIterator.html" title="trait core::iter::traits::collect::FromIterator"><code>FromIterator</code></a> trait which can create sequences or maps.  When
given a tuple it creates maps, otherwise it makes a sequence.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// collection into a sequence
</span><span class="kw">let </span>value: Value = (<span class="number">1</span>..<span class="number">10</span>).into_iter().collect();

<span class="comment">// collection into a map
</span><span class="kw">let </span>value: Value = [(<span class="string">"key"</span>, <span class="string">"value"</span>)].into_iter().collect();</code></pre></div>
<p>For certain types of iterators (<code>Send</code> + <code>Sync</code> + <code>'static</code>) it’s also
possible to make the value lazily iterate over the value by using the
<a href="struct.Value.html#method.make_iterable" title="associated function minijinja::value::Value::make_iterable"><code>Value::make_iterable</code></a> function instead.  Whenever the value requires
iteration, the function is called to create that iterator.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>value: Value = Value::make_iterable(|| <span class="number">1</span>..<span class="number">10</span>);</code></pre></div>
<p>To to into the inverse directly the various <a href="https://doc.rust-lang.org/1.77.2/core/convert/trait.TryFrom.html" title="trait core::convert::TryFrom"><code>TryFrom</code></a>
implementations can be used:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>std::convert::TryFrom;
<span class="kw">let </span>v = u64::try_from(Value::from(<span class="number">42</span>)).unwrap();</code></pre></div>
<p>The special <a href="struct.Value.html#associatedconstant.UNDEFINED" title="associated constant minijinja::value::Value::UNDEFINED"><code>Undefined</code></a> value also exists but does not
have a rust equivalent.  It can be created via the <a href="struct.Value.html#associatedconstant.UNDEFINED" title="associated constant minijinja::value::Value::UNDEFINED"><code>UNDEFINED</code></a>
constant.</p>
<h2 id="collections"><a class="doc-anchor" href="#collections">§</a>Collections</h2>
<p>The standard library’s collection types such as
<a href="https://doc.rust-lang.org/1.77.2/std/collections/hash/map/struct.HashMap.html" title="struct std::collections::hash::map::HashMap"><code>HashMap</code></a>, <a href="https://doc.rust-lang.org/1.77.2/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec"><code>Vec</code></a> and various others from the
collections module are implemented are objects.  There is a cavet here which is
that maps can only have string or <a href="struct.Value.html" title="struct minijinja::value::Value"><code>Value</code></a> as key.  The values in the collections
are lazily converted into value when accessed or iterated over.   These types can
be constructed either from <a href="struct.Value.html#method.from" title="associated function minijinja::value::Value::from"><code>Value::from</code></a> or <a href="struct.Value.html#method.from_object" title="associated function minijinja::value::Value::from_object"><code>Value::from_object</code></a>.  Because the
types are boxed unchanged, you can also downcast them.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>vec = Value::from(<span class="macro">vec!</span>[<span class="number">1i32</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);
<span class="kw">let </span>vec_ref = vec.downcast_object_ref::&lt;Vec&lt;i32&gt;&gt;().unwrap();
<span class="macro">assert_eq!</span>(vec_ref, <span class="kw-2">&amp;</span><span class="macro">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</code></pre></div>
<p><strong>Caveat:</strong> for convenience reasons maps with <code>&amp;str</code> keys can be stored.  The keys
however are converted into <code>Arc&lt;str&gt;</code>.</p>
<h2 id="serde-conversions"><a class="doc-anchor" href="#serde-conversions">§</a>Serde Conversions</h2>
<p>MiniJinja will usually however create values via an indirection via <a href="../../serde/index.html" title="mod serde"><code>serde</code></a> when
a template is rendered or an expression is evaluated.  This can also be
triggered manually by using the <a href="struct.Value.html#method.from_serialize" title="associated function minijinja::value::Value::from_serialize"><code>Value::from_serialize</code></a> method:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>value = Value::from_serialize(<span class="kw-2">&amp;</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</code></pre></div>
<p>The inverse of that operation is to pass a value directly as serializer to
a type that supports deserialization.  This requires the <code>deserialization</code>
feature.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>serde::Deserialize;
<span class="kw">let </span>value = Value::from(<span class="macro">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);
<span class="kw">let </span>vec = Vec::&lt;i32&gt;::deserialize(value).unwrap();</code></pre></div>
<h2 id="value-function-arguments"><a class="doc-anchor" href="#value-function-arguments">§</a>Value Function Arguments</h2>
<p><a href="../filters/index.html" title="mod minijinja::filters">Filters</a> and <a href="../tests/index.html" title="mod minijinja::tests">tests</a> can take values as arguments
but optionally also rust types directly.  This conversion for function arguments
is performed by the <a href="trait.FunctionArgs.html" title="trait minijinja::value::FunctionArgs"><code>FunctionArgs</code></a> and related traits (<a href="trait.ArgType.html" title="trait minijinja::value::ArgType"><code>ArgType</code></a>, <a href="trait.FunctionResult.html" title="trait minijinja::value::FunctionResult"><code>FunctionResult</code></a>).</p>
<h2 id="memory-management"><a class="doc-anchor" href="#memory-management">§</a>Memory Management</h2>
<p>Values are immutable objects which are internally reference counted which
means they can be copied relatively cheaply.  Special care must be taken
so that cycles are not created to avoid causing memory leaks.</p>
<h2 id="html-escaping"><a class="doc-anchor" href="#html-escaping">§</a>HTML Escaping</h2>
<p>MiniJinja inherits the general desire to be clever about escaping.  For this
purpose a value will (when auto escaping is enabled) always be escaped.  To
prevent this behavior the <a href="../filters/fn.safe.html" title="fn minijinja::filters::safe"><code>safe</code></a> filter can be used
in the template.  Outside of templates the <a href="struct.Value.html#method.from_safe_string" title="associated function minijinja::value::Value::from_safe_string"><code>Value::from_safe_string</code></a> method
can be used to achieve the same result.</p>
<h2 id="dynamic-objects"><a class="doc-anchor" href="#dynamic-objects">§</a>Dynamic Objects</h2>
<p>Values can also hold “dynamic” objects.  These are objects which implement the
<a href="trait.Object.html" title="trait minijinja::value::Object"><code>Object</code></a> trait.  These can be used to implement dynamic functionality such
as stateful values and more.  Dynamic objects are internally also used to
implement the special <code>loop</code> variable, macros and similar things.</p>
<p>To create a <a href="struct.Value.html" title="struct minijinja::value::Value"><code>Value</code></a> from a dynamic object use <a href="struct.Value.html#method.from_object" title="associated function minijinja::value::Value::from_object"><code>Value::from_object</code></a>,
<a href="struct.Value.html#method.from_dyn_object" title="associated function minijinja::value::Value::from_dyn_object"><code>Value::from_dyn_object</code></a>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attr">#[derive(Debug)]
</span><span class="kw">struct </span>Foo;

<span class="kw">impl </span>Object <span class="kw">for </span>Foo {
    <span class="comment">/* implementation */
</span>}

<span class="kw">let </span>value = Value::from_object(Foo);
<span class="kw">let </span>value = Value::from_dyn_object(Arc::new(Foo));</code></pre></div>
<h2 id="invalid-values"><a class="doc-anchor" href="#invalid-values">§</a>Invalid Values</h2>
<p>MiniJinja knows the concept of an “invalid value”.  These are rare in practice
and should not be used, but they are needed in some situations.  An invalid value
looks like a value but working with that value in the context of the engine will
fail in most situations.  In principle an invalid value is a value that holds an
error internally.  It’s created with <a href="https://doc.rust-lang.org/1.77.2/core/convert/trait.From.html" title="trait core::convert::From"><code>From</code></a>:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>minijinja::{Value, Error, ErrorKind};
<span class="kw">let </span>error = Error::new(ErrorKind::InvalidOperation, <span class="string">"failed to generate an item"</span>);
<span class="kw">let </span>invalid_value = Value::from(error);</code></pre></div>
<p>Invalid values are typically encountered in the following situations:</p>
<ul>
<li>serialization fails with an error: this is the case when a value is crated
via <a href="struct.Value.html#method.from_serialize" title="associated function minijinja::value::Value::from_serialize"><code>Value::from_serialize</code></a> and the underlying <a href="../../serde/ser/trait.Serialize.html" title="trait serde::ser::Serialize"><code>Serialize</code></a> implementation
fails with an error.</li>
<li>fallible iteration: there might be situations where an iterator cannot indicate
failure ahead of iteration and must abort.  In that case the only option an
iterator in MiniJinja has is to create an invalid value.</li>
</ul>
<p>It’s generally recommende to ignore the existence of invalid objects and let them
fail naturally as they are encountered.</p>
</div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.DynObject.html" title="struct minijinja::value::DynObject">DynObject</a></div><div class="desc docblock-short">Typed-erased version of
<a href="trait.Object.html" title="trait minijinja::value::Object"><code>Object</code></a></div></li><li><div class="item-name"><a class="struct" href="struct.Kwargs.html" title="struct minijinja::value::Kwargs">Kwargs</a></div><div class="desc docblock-short">Utility to accept keyword arguments.</div></li><li><div class="item-name"><a class="struct" href="struct.Rest.html" title="struct minijinja::value::Rest">Rest</a></div><div class="desc docblock-short">Utility type to capture remaining arguments.</div></li><li><div class="item-name"><a class="struct" href="struct.Value.html" title="struct minijinja::value::Value">Value</a></div><div class="desc docblock-short">Represents a dynamically typed value in the template engine.</div></li><li><div class="item-name"><a class="struct" href="struct.ValueIter.html" title="struct minijinja::value::ValueIter">ValueIter</a></div><div class="desc docblock-short">Utility to iterate over values.</div></li><li><div class="item-name"><a class="struct" href="struct.ViaDeserialize.html" title="struct minijinja::value::ViaDeserialize">ViaDeserialize</a></div><div class="desc docblock-short">Utility type to deserialize an argument.</div></li></ul><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.Enumerator.html" title="enum minijinja::value::Enumerator">Enumerator</a></div><div class="desc docblock-short">Enumerators help define iteration behavior for <a href="trait.Object.html" title="trait minijinja::value::Object"><code>Object</code></a>s.</div></li><li><div class="item-name"><a class="enum" href="enum.ObjectRepr.html" title="enum minijinja::value::ObjectRepr">ObjectRepr</a></div><div class="desc docblock-short">Defines the natural representation of this object.</div></li><li><div class="item-name"><a class="enum" href="enum.ValueKind.html" title="enum minijinja::value::ValueKind">ValueKind</a></div><div class="desc docblock-short">Describes the kind of value.</div></li></ul><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.ArgType.html" title="trait minijinja::value::ArgType">ArgType</a></div><div class="desc docblock-short">A trait implemented by all filter/test argument types.</div></li><li><div class="item-name"><a class="trait" href="trait.FunctionArgs.html" title="trait minijinja::value::FunctionArgs">FunctionArgs</a></div><div class="desc docblock-short">Helper trait representing valid filter, test and function arguments.</div></li><li><div class="item-name"><a class="trait" href="trait.FunctionResult.html" title="trait minijinja::value::FunctionResult">FunctionResult</a></div><div class="desc docblock-short">A utility trait that represents the return value of functions and filters.</div></li><li><div class="item-name"><a class="trait" href="trait.Object.html" title="trait minijinja::value::Object">Object</a></div><div class="desc docblock-short">A trait that represents a dynamic object.</div></li><li><div class="item-name"><a class="trait" href="trait.ObjectExt.html" title="trait minijinja::value::ObjectExt">ObjectExt</a></div><div class="desc docblock-short">Provides utility methods for working with objects.</div></li></ul><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">§</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.from_args.html" title="fn minijinja::value::from_args">from_args</a></div><div class="desc docblock-short">Utility function to convert a slice of values into arguments.</div></li><li><div class="item-name"><a class="fn" href="fn.intern.html" title="fn minijinja::value::intern">intern</a></div><div class="desc docblock-short">Intern a string.</div></li><li><div class="item-name"><a class="fn" href="fn.serializing_for_value.html" title="fn minijinja::value::serializing_for_value">serializing_for_value</a></div><div class="desc docblock-short">Function that returns true when serialization for <a href="struct.Value.html" title="struct minijinja::value::Value"><code>Value</code></a> is taking place.</div></li></ul></section></div></main></body></html>